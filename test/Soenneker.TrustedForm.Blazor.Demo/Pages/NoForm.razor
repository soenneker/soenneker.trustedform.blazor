@page "/no-form"
@using Soenneker.TrustedForm.Blazor
@using Soenneker.TrustedForm.Blazor.Options

<div class="header" >
    <div class="header-content" >
        <div class="logo" >📄</div>
        <h1>TrustedForm No-Form Demo</h1>
        <p>Demonstrating TrustedForm integration without traditional form elements. Perfect for single-page applications and dynamic content.</p>
    </div>
</div>

<div class="content" >
    <!-- Status Overview -->
    <div class="section fade-in" >
        <h2 class="section-title" >System Status</h2>
        <div class="status-grid" >
            <div class="status-card @(_trustedFormLoaded ? "active" : "inactive")" >
                <div class="status-icon" >@(_trustedFormLoaded ? "✅" : "⏳")</div>
                <div class="status-label" >TrustedForm Status</div>
                <div class="status-value" >@(_trustedFormLoaded ? "Ready" : "Loading...")</div>
            </div>
            <div class="status-card @(_trustedFormRef?.IsRecording() == true ? "active" : "inactive")" >
                <div class="status-icon" >@(_trustedFormRef?.IsRecording() == true ? "🔴" : "⏸️")</div>
                <div class="status-label" >Recording State</div>
                <div class="status-value" >@(_trustedFormRef?.IsRecording() == true ? "Active" : "Inactive")</div>
            </div>
            <div class="status-card @(_certUrl != null ? "active" : "inactive")" >
                <div class="status-icon" >@(_certUrl != null ? "📋" : "📄")</div>
                <div class="status-label" >Cert URL</div>
                <div class="status-value" >@(_certUrl != null ? "Available" : "Not Generated")</div>
            </div>
        </div>
    </div>

    <!-- TrustedForm Integration -->
    <div class="section fade-in" >
        <h2 class="section-title" >TrustedForm Integration</h2>
        <p style="color: var(--text-secondary); margin-bottom: 2rem;" >This page demonstrates TrustedForm integration without traditional form elements. The component automatically includes a form element when <code>IncludeForm = true</code> is set in the configuration.</p>

        <TrustedForm @ref="_trustedFormRef" OnLoad="OnTrustedFormLoaded" Configuration="_trustedFormConfig" />

        <div class="btn-group" >
            <button @onclick="GetCertUrl" class="btn btn-primary" disabled="@(!_trustedFormLoaded)" >
                <span>🔗</span>
                Get Cert URL
            </button>
            <button @onclick="StartIfNotRunning" class="btn btn-success" disabled="@(!_trustedFormLoaded)" >
                <span>▶️</span>
                Start Recording
            </button>
            <button @onclick="StopTrustedForm" class="btn btn-danger" disabled="@(!_trustedFormLoaded)" >
                <span>⏹️</span>
                Stop Recording
            </button>
        </div>

        @if (_certUrl != null)
        {
            <div class="alert alert-info slide-in" >
                <div class="alert-title" >🔗 TrustedForm Certification URL</div>
                <div class="code-block" style="margin-top: 1rem; word-break: break-all; font-size: 0.75rem;" >
                    @_certUrl
                </div>
            </div>
        }

        @if (_trustedFormStopped)
        {
            <div class="alert alert-warning slide-in" >
                <div class="alert-title" >⏸️ Recording Stopped</div>
                TrustedForm recording has been successfully stopped. You can restart it using the "Start Recording" button.
            </div>
        }
    </div>

    <!-- Use Cases -->
    <div class="section fade-in" >
        <h2 class="section-title" >Perfect For</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;" >
            <div class="status-card" >
                <div class="status-icon" >📱</div>
                <div class="status-label" >Single Page Apps</div>
                <div class="status-value" >SPA Integration</div>
            </div>
            <div class="status-card" >
                <div class="status-icon" >🎯</div>
                <div class="status-label" >Dynamic Content</div>
                <div class="status-value" >AJAX Forms</div>
            </div>
            <div class="status-card" >
                <div class="status-icon" >⚡</div>
                <div class="status-label" >Real-time Apps</div>
                <div class="status-value" >Live Updates</div>
            </div>
        </div>
    </div>
</div>

@code {
    private TrustedForm? _trustedFormRef;
    private readonly TrustedFormConfiguration _trustedFormConfig = new() {IncludeForm = true};
    private string? _certUrl;
    private bool _trustedFormLoaded;
    private bool _trustedFormStopped;

    private async Task StopTrustedForm()
    {
        if (_trustedFormRef is not null)
        {
            await _trustedFormRef.Stop();
            _trustedFormStopped = true;
            StateHasChanged();
        }
    }

    private async Task StartIfNotRunning()
    {
        if (_trustedFormRef is not null)
        {
            await _trustedFormRef.StartIfNotRunning();
            _trustedFormStopped = false;
            StateHasChanged();
        }
    }

    private void OnTrustedFormLoaded()
    {
        _trustedFormLoaded = true;
        _certUrl = null;
        _trustedFormStopped = false;
        StateHasChanged();
    }

    private async Task GetCertUrl()
    {
        if (_trustedFormRef is not null)
        {
            _certUrl = await _trustedFormRef.GetCertUrl();
            StateHasChanged();
        }
    }

}